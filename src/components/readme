# üêæ OpitWeb v2.0 - Rastreador de Pre√ßos Amazon

Plataforma moderna de rastreamento de pre√ßos para produtos pet na Amazon, constru√≠da com Next.js 14, Supabase e hospedada na Vercel.

## üöÄ Stack Tecnol√≥gica

- **Frontend**: Next.js 14 (App Router) + React 18
- **Styling**: Tailwind CSS
- **Database**: Supabase (PostgreSQL)
- **Authentication**: Supabase Auth
- **Hosting**: Vercel
- **Email**: Resend
- **Charts**: Recharts
- **Scraping**: Cheerio + Axios

## üì¶ Instala√ß√£o

### Pr√©-requisitos

- Node.js 18+ instalado
- Conta no GitHub
- Conta no Supabase
- Conta no Vercel
- Conta no Resend (para emails)

### Passo 1: Clone o Reposit√≥rio

```bash
git clone https://github.com/seu-usuario/opitweb-v2.git
cd opitweb-v2
```

### Passo 2: Instalar Depend√™ncias

```bash
npm install
```

### Passo 3: Configurar Supabase

1. Acesse [supabase.com](https://supabase.com) e crie um novo projeto
2. No SQL Editor, execute o script de cria√ß√£o das tabelas (veja se√ß√£o abaixo)
3. Em Settings ‚Üí API, copie:
   - Project URL
   - anon/public key
   - service_role key

### Passo 4: Configurar Vari√°veis de Ambiente

```bash
cp .env.example .env.local
```

Preencha com suas credenciais:

```env
NEXT_PUBLIC_SUPABASE_URL=sua_url_do_supabase
NEXT_PUBLIC_SUPABASE_ANON_KEY=sua_chave_anon
SUPABASE_SERVICE_ROLE_KEY=sua_service_role_key
RESEND_API_KEY=sua_chave_resend
AMAZON_AFFILIATE_TAG=opitweb-20
CRON_SECRET=gere_um_segredo_aleatorio
```

### Passo 5: Rodar Localmente

```bash
npm run dev
```

Acesse: http://localhost:3000

## üóÑÔ∏è Setup do Banco de Dados

Execute este SQL no Supabase SQL Editor:

```sql
-- Habilitar extens√µes necess√°rias
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Tabela de produtos
CREATE TABLE products (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  asin VARCHAR(20) UNIQUE NOT NULL,
  title TEXT NOT NULL,
  description TEXT,
  image_url TEXT,
  category VARCHAR(100),
  affiliate_link TEXT NOT NULL,
  current_price DECIMAL(10,2),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Tabela de hist√≥rico de pre√ßos
CREATE TABLE price_history (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  product_id UUID REFERENCES products(id) ON DELETE CASCADE,
  price DECIMAL(10,2) NOT NULL,
  recorded_at TIMESTAMP DEFAULT NOW()
);

-- Tabela de alertas
CREATE TABLE price_alerts (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  product_id UUID REFERENCES products(id) ON DELETE CASCADE,
  target_price DECIMAL(10,2) NOT NULL,
  is_active BOOLEAN DEFAULT true,
  notified_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Tabela de ofertas destacadas
CREATE TABLE featured_deals (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  product_id UUID REFERENCES products(id) ON DELETE CASCADE,
  discount_percentage INTEGER,
  is_active BOOLEAN DEFAULT true,
  position INTEGER,
  created_at TIMESTAMP DEFAULT NOW()
);

-- √çndices para performance
CREATE INDEX idx_products_asin ON products(asin);
CREATE INDEX idx_products_category ON products(category);
CREATE INDEX idx_price_history_product ON price_history(product_id, recorded_at DESC);
CREATE INDEX idx_alerts_user ON price_alerts(user_id, is_active);
CREATE INDEX idx_alerts_product ON price_alerts(product_id, is_active);
CREATE INDEX idx_featured_active ON featured_deals(is_active, position);

-- RLS (Row Level Security) Policies
ALTER TABLE price_alerts ENABLE ROW LEVEL SECURITY;

-- Usu√°rios podem ver apenas seus pr√≥prios alertas
CREATE POLICY "Users can view own alerts"
  ON price_alerts FOR SELECT
  USING (auth.uid() = user_id);

-- Usu√°rios podem criar seus pr√≥prios alertas
CREATE POLICY "Users can create own alerts"
  ON price_alerts FOR INSERT
  WITH CHECK (auth.uid() = user_id);

-- Usu√°rios podem atualizar seus pr√≥prios alertas
CREATE POLICY "Users can update own alerts"
  ON price_alerts FOR UPDATE
  USING (auth.uid() = user_id);

-- Fun√ß√£o para atualizar updated_at automaticamente
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Trigger para produtos
CREATE TRIGGER update_products_updated_at
  BEFORE UPDATE ON products
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at_column();
```

## üîß Configura√ß√£o do Resend (Email)

1. Acesse [resend.com](https://resend.com)
2. Crie uma conta e verifique seu dom√≠nio
3. Gere uma API Key
4. Configure os registros DNS:

```
Type: TXT
Name: _resend
Value: [valor fornecido pelo Resend]

Type: MX
Name: @
Value: feedback-smtp.us-east-1.amazonses.com
Priority: 10
```

## üö¢ Deploy na Vercel

### Via GitHub (Recomendado)

1. Commit e push para o GitHub:
```bash
git add .
git commit -m "Initial setup"
git push origin main
```

2. Acesse [vercel.com](https://vercel.com)
3. Clique em "New Project"
4. Importe seu reposit√≥rio do GitHub
5. Configure as vari√°veis de ambiente
6. Deploy!

### Configurar Dom√≠nio Customizado

1. Na Vercel: Settings ‚Üí Domains
2. Adicione: `opitweb.com.br` e `www.opitweb.com.br`
3. Na Hostinger (ou seu provedor de DNS):

```
Type: A
Name: @
Value: 76.76.21.21

Type: CNAME
Name: www
Value: cname.vercel-dns.com
```

## ‚è∞ Configurar Cron Jobs

Crie `vercel.json` na raiz:

```json
{
  "crons": [
    {
      "path": "/api/cron/check-prices",
      "schedule": "0 */6 * * *"
    }
  ]
}
```

Este cron vai verificar pre√ßos a cada 6 horas.

## üìù Estrutura de Pastas

```
opitweb-v2/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/              # P√°ginas e rotas
‚îÇ   ‚îú‚îÄ‚îÄ components/       # Componentes React
‚îÇ   ‚îú‚îÄ‚îÄ lib/             # Utilit√°rios e configs
‚îÇ   ‚îú‚îÄ‚îÄ hooks/           # Custom hooks
‚îÇ   ‚îî‚îÄ‚îÄ types/           # TypeScript types
‚îú‚îÄ‚îÄ public/              # Arquivos est√°ticos
‚îî‚îÄ‚îÄ supabase/           # Migrations (opcional)
```

## üîê Autentica√ß√£o

### Configurar Email Provider no Supabase

1. Supabase Dashboard ‚Üí Authentication ‚Üí Providers
2. Habilite "Email"
3. Configure o template de emails
4. URL de redirecionamento: `https://opitweb.com.br/auth/callback`

### Implementar em Next.js

O projeto j√° vem com:
- Login/Registro
- Recupera√ß√£o de senha
- Prote√ß√£o de rotas
- Middleware de autentica√ß√£o

## üìä Features Implementadas

- ‚úÖ Sistema de rastreamento de pre√ßos
- ‚úÖ Hist√≥rico de pre√ßos com gr√°ficos
- ‚úÖ Alertas de pre√ßo por email
- ‚úÖ Autentica√ß√£o de usu√°rios
- ‚úÖ Dashboard personalizado
- ‚úÖ Painel administrativo
- ‚úÖ Sistema de ofertas destacadas
- ‚úÖ Scraping autom√°tico da Amazon
- ‚úÖ API RESTful completa
- ‚úÖ Responsive design
- ‚úÖ SEO otimizado

## üéØ Pr√≥ximos Passos

1. **Adicionar produtos iniciais** via painel admin
2. **Testar sistema de alertas** criando alertas de teste
3. **Configurar Google Analytics** (opcional)
4. **Criar conte√∫do para o blog**
5. **Otimizar SEO** das p√°ginas
6. **Adicionar mais categorias**
7. **Implementar sistema de busca avan√ßada**
8. **Criar extens√£o do navegador** (futuro)

## üêõ Troubleshooting

### Erro de CORS no Supabase
- Verifique se as URLs est√£o corretas no `.env.local`
- Confirme que o projeto est√° rodando em `localhost:3000`

### Scraping n√£o funciona
- Amazon tem prote√ß√£o anti-bot forte
- Considere usar a API oficial da Amazon (Product Advertising API)
- Implemente rate limiting e rota√ß√£o de User-Agent

### Emails n√£o enviam
- Verifique se o dom√≠nio est√° verificado no Resend
- Confirme os registros DNS
- Teste com um email pessoal primeiro

## üìû Suporte

Para d√∫vidas ou problemas:
- Email: contato@opitweb.com.br
- WhatsApp: (11) 96101-7230

## üìÑ Licen√ßa

Propriedade privada - Todos os direitos reservados ¬© 2024 OpitWeb

---

**Desenvolvido com ‚ù§Ô∏è para tutores de pets que querem economizar!** üê∂üê±
